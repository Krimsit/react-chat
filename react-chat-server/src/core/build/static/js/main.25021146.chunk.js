(this.webpackJsonplichat=this.webpackJsonplichat||[]).push([[0],{123:function(e,t,n){"use strict";n.r(t);var a=n(91);t.default=Object(a.c)(["messages","dialogs","user","attachments"].reduce((function(e,t){return e[t]=n(361)("./".concat(t)).default,e}),{}))},222:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var a=n(13),s={items:[]};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case"ATTACHMENTS:SET_ITEM":return Object(a.a)(Object(a.a)({},e),{},{items:c});case"ATTACHMENTS:REMOVE_ITEM":return Object(a.a)(Object(a.a)({},e),{},{items:e.items.filter((function(e){return e.uid!==c.uid}))});default:return e}}},223:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var a=n(13),s={items:[],currentDialogId:window.location.pathname.split("dialog/")[1],isLoading:!1};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case"DIALOGS:SET_ITEMS":return Object(a.a)(Object(a.a)({},e),{},{items:c});case"DIALOGS:SET_CURRENT_DIALOG_ID":return Object(a.a)(Object(a.a)({},e),{},{currentDialogId:c});default:return e}}},224:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n(166),s=n(13),c={items:[],isLoading:!1};function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments.length>1?arguments[1]:void 0,n=t.type,i=t.payload;switch(n){case"MESSAGES:ADD_MESSAGE":return Object(s.a)(Object(s.a)({},e),{},{items:[].concat(Object(a.a)(e.items),[i])});case"MESSAGES:SET_ITEMS":return Object(s.a)(Object(s.a)({},e),{},{items:i,isLoading:!1});case"MESSAGES:REMOVE_MESSAGE":return Object(s.a)(Object(s.a)({},e),{},{items:e.items.filter((function(e){return e._id!==i}))});case"MESSAGES:SET_IS_LOADING":return Object(s.a)(Object(s.a)({},e),{},{isLoading:i});default:return e}}},225:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var a=n(13),s={data:null,token:window.localStorage.token,isAuth:!!window.localStorage.token};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case"USER:SET_DATA":return Object(a.a)(Object(a.a)({},e),{},{data:c,isAuth:!0,token:window.localStorage.token});case"USER:SET_IS_AUTH":return Object(a.a)(Object(a.a)({},e),{},{isAuth:c});default:return e}}},361:function(e,t,n){var a={"./":123,"./attachments":222,"./attachments.js":222,"./dialogs":223,"./dialogs.js":223,"./index":123,"./index.js":123,"./messages":224,"./messages.js":224,"./user":225,"./user.js":225};function s(e){var t=c(e);return n(t)}function c(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}s.keys=function(){return Object.keys(a)},s.resolve=c,e.exports=s,s.id=361},362:function(e,t,n){},365:function(e,t,n){},379:function(e,t,n){},475:function(e,t,n){},487:function(e,t,n){},488:function(e,t,n){},493:function(e,t,n){},494:function(e,t,n){},521:function(e,t,n){},522:function(e,t,n){},523:function(e,t,n){},525:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n(0),c=n(40),i=n.n(c),r=n(72),o=n(48),u=n(129),l=n.n(u);l.a.defaults.baseURL=window.location.origin,l.a.defaults.headers.common.token=window.localStorage.token,window.axios=l.a;var d=l.a,j={getAll:function(){return d.get("/dialogs")},create:function(e){var t=e.partner,n=e.text;return d.post("/dialogs",{partner:t,text:n})}},h={getAllByDialogId:function(e){return d.get("/messages?dialog="+e)},removeById:function(e){return d.delete("/messages?id="+e)},send:function(e,t,n){return d.post("/messages",{text:e,dialog_id:t,attachments:n})}},b={signin:function(e){return d.post("/user/signin",e)},signup:function(e){return d.post("/user/signup",e)},verifyHash:function(e){return d.get("/user/verify?hash="+e)},getMe:function(){return d.get("/user/me")},findUsers:function(e){return d.get("/user/find?query="+e)}},f={upload:function(e){var t=new FormData;return t.append("file",e),d.post("/files",t,{headers:{"Content-Type":"multipart/form-data"}})}},m=n(246),O=n.n(m)()(window.location.origin.replace("3000","3003")),g={setDialogs:function(e){return{type:"DIALOGS:SET_ITEMS",payload:e}},setCurrentDialogId:function(e){return function(t){O.emit("DIALOGS:JOIN",e),t({type:"DIALOGS:SET_CURRENT_DIALOG_ID",payload:e})}},fetchDialogs:function(){return function(e){j.getAll().then((function(t){var n=t.data;e(g.setDialogs(n))}))}}},p=g,v={setMessages:function(e){return{type:"MESSAGES:SET_ITEMS",payload:e}},addMessage:function(e){return function(t,n){n().dialogs.currentDialogId===e.dialog._id&&t({type:"MESSAGES:ADD_MESSAGE",payload:e})}},fetchSendMessage:function(e){var t=e.text,n=e.dialogId,a=e.attachments;return function(e){return h.send(t,n,a)}},setIsLoading:function(e){return{type:"MESSAGES:SET_IS_LOADING",payload:e}},removeMessageById:function(e){return function(t){window.confirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?")&&h.removeById(e).then((function(n){n.data;t({type:"MESSAGES:REMOVE_MESSAGE",payload:e})})).catch((function(){t(v.setIsLoading(!1))}))}},fetchMessages:function(e){return function(t){t(v.setIsLoading(!0)),h.getAllByDialogId(e).then((function(e){var n=e.data;t(v.setMessages(n))})).catch((function(){t(v.setIsLoading(!1))}))}}},x=v,_=function(e,t,n){return t[e]?n[e]?"error":"success":""};function S(e){var t=Math.floor(e/60),n=(e%60).toFixed();return"".concat(t<10?"0":"").concat(t,":").concat(n<10?"0":"").concat(n)}var E=n(32),w=n(188),y=n.n(w);var A=n(284);function N(e){var t=e.text,n=e.type,a=void 0===n?"info":n,s=e.title,c=e.duration,i=void 0===c?3:c;A.a[a]({message:s,description:t,duration:i})}var I=function(e){if(!e)return null;var t=e[0];return e.length&&"webm"===t.ext},M={setUserData:function(e){return{type:"USER:SET_DATA",payload:e}},setIsAuth:function(e){return{type:"USER:SET_IS_AUTH",payload:e}},fetchUserData:function(){return function(e){b.getMe().then((function(t){var n=t.data;e(M.setUserData(n))})).catch((function(t){403===t.response.status&&(e(M.setIsAuth(!1)),delete window.localStorage.token)}))}},fetchUserLogin:function(e){return function(t){return b.signin(e).then((function(e){var n=e.data,a=n.token;return N({text:"\u0412\u044b \u0432\u043e\u0448\u043b\u0438 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442",type:"success",title:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e"}),window.axios.defaults.headers.common.token=a,window.localStorage.token=a,t(M.fetchUserData()),t(M.setIsAuth(!0)),n})).catch((function(e){403===e.response.status&&N({text:"\u0412\u044b \u0432\u043e\u0448\u043b\u0438 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442",type:"success",title:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e"})}))}},fetchUserRegister:function(e){return function(t){return b.signup(e).then((function(e){return e.data}))}}},T=M,k={setAttachments:function(e){return{type:"ATTACHMENTS:SET_ITEM",payload:e}},removeAttachments:function(e){return{type:"ATTACHMENTS:REMOVE_ITEM",payload:e}}},R=n(91),D=n(248),C=n(123),L=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||R.d,U=[D.a],G=Object(R.e)(C.default,L(R.a.apply(void 0,U))),V=n(36),F=n(161);function P(e){var t=e.isAuth,n=e.values,a=e.errors,s={email:function(e,t){t?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(t)||(e.email="\u041d\u0435\u0432\u0435\u0440\u043d\u043e \u0432\u0432\u0435\u0434\u0451\u043d E-mail"):e.email="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 E-mail"},password:function(e,n){n?t||/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})/i.test(n)||(e.password="\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c 8 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0441\u0440\u0435\u0434\u0438 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043c\u0438\u043d\u0438\u043c\u0443\u043c 1 \u0437\u0430\u0433\u043b\u0430\u0432\u043d\u0430\u044f \u0431\u0443\u043a\u0432\u0430, 1 \u043f\u0440\u043e\u043f\u0438\u0441\u043d\u0430\u044f \u0431\u0443\u043a\u0432\u0430 \u0438 1 \u0446\u0438\u0444\u0440\u0430"):e.password="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},password_2:function(e,a){t||a===n.password||(e.password_2="\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442")},fullname:function(e,n){t||n?t||/^(?=.*[a-zA-Z0-9\u0410-\u042f\u0430-\u044f])(?=.{6,})/i.test(n)||(e.fullname="\u0418\u043c\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 6 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):e.fullname="\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0441\u0432\u043e\u0451 \u0438\u043c\u044f"}};Object.keys(n).forEach((function(e){return s[e]&&s[e](a,n[e])}))}var B=n(529),H=n(546),z=n(547),Z=n(13),J=n(76),q=n(5),X=n.n(q),K=(n(362),function(e){return Object(a.jsx)(J.a,Object(Z.a)(Object(Z.a)({},e),{},{className:X()("button",e.className,{"button--large":"large"===e.size})}))}),W=(n(365),function(e){var t=e.children,n=e.className;return Object(a.jsx)("div",{className:X()("block",n),children:t})}),Y=n(116),$=n(117),Q=n(530),ee=n(535),te=n(536),ne=n(251),ae=n.n(ne),se=n(162),ce=(n(379),function(e){var t=e.audio,n=Object(s.useState)(!1),c=Object(E.a)(n,2),i=c[0],r=c[1],o=Object(s.useState)(0),u=Object(E.a)(o,2),l=u[0],d=u[1],j=Object(s.useState)(0),h=Object(E.a)(j,2),b=h[0],f=h[1],m=Object(s.useRef)(null);Object(s.useEffect)((function(){m.current.addEventListener("playing",(function(){r(!0)}),!1),m.current.addEventListener("ended",(function(){r(!1),d(0)}),!1),m.current.addEventListener("pause",(function(){r(!1)}),!1),m.current.addEventListener("timeupdate",(function(){var e=m.current&&m.current.duration||0;f(m.current.currentTime),d(m.current.currentTime/e*100)}),!1)}),[]);return Object(a.jsxs)("div",{className:"message__audio",children:[Object(a.jsx)("audio",{src:t,preload:"auto",ref:m}),Object(a.jsx)("div",{className:"message__audio-progress",style:{width:l+"%"}}),Object(a.jsxs)("div",{className:"message__audio-info",children:[Object(a.jsx)("div",{className:"message__audio-btn",children:Object(a.jsx)("button",{onClick:function(){i?m.current.pause():m.current.play()},children:i?Object(a.jsx)(Y.a,{icon:$.c,color:"#ffffff",alt:"Play"}):Object(a.jsx)(Y.a,{icon:$.d,color:"#ffffff",alt:"Play"})})}),Object(a.jsx)("div",{className:"message__audio-wave",children:Object(a.jsx)("img",{src:"https://raw.githubusercontent.com/Archakov06/react-chat-tutorial/cd5cd6442cb796b41f7354ba9587b38e87829592/src/assets/img/wave.svg",alt:"Wave"})}),Object(a.jsx)("span",{className:"message__audio-duration",children:S(b)})]})]})}),ie=function(e){var t=e.user,n=e.text,s=e.date,c=e.isMe,i=e.readed,r=e.attachments,o=e.isTyping,u=e.onRemoveMessage;return Object(a.jsx)("div",{className:X()("message",{"message--isme":c,"message--is-typing":o,"message--image":!I(r)&&r&&1===r.length&&!n,"message--is-audio":I(r)}),children:Object(a.jsxs)("div",{className:"message__content",children:[Object(a.jsx)(ve,{isMe:c,isReaded:i}),Object(a.jsx)(ee.a,{content:Object(a.jsx)("div",{children:Object(a.jsx)(J.a,{onClick:u,children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})}),trigger:"click",children:Object(a.jsx)("div",{className:"message__icon-actions",children:Object(a.jsx)(J.a,{type:"link",shape:"circle",icon:Object(a.jsx)(te.a,{})})})}),Object(a.jsx)("div",{className:"message__avatar",children:Object(a.jsx)(xe,{user:t})}),Object(a.jsxs)("div",{className:"message__info",children:[(n||o)&&Object(a.jsx)("div",{className:"message__bubble",children:n&&Object(a.jsx)("p",{className:"message__text",children:ae()(n,/:(.+?):/g,(function(e,t){return Object(a.jsx)(se.a,{emoji:e,set:"apple",size:16},t)}))})}),r&&Object(a.jsx)("div",{className:"message__attachments",children:r.map((function(e){return function(e){return"webm"!==e.ext?Object(a.jsx)("div",{className:"message__attachments-item",children:Object(a.jsx)(Q.a,{src:e.url,alt:e.filename})},e._id):Object(a.jsx)(ce,{audio:e.url})}(e)}))}),s&&Object(a.jsx)("span",{className:"message__date",children:Object(a.jsx)(pe,{date:new Date(s)})})]})]})})};ie.defaultProps={user:{}};var re=ie,oe=n(192),ue=n(283),le=function(e,t){return!e.text&&I(e.attachments)&&e.attachments.length?"\u0413\u043e\u043b\u043e\u0441\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435":!e.text&&e.attachments.length?"\u0424\u043e\u0442\u043e":e.text?e.text:void 0},de=function(e){var t,n=e.unreaded,s=e.isMe,c=e._id,i=e.currentDialogId,o=e.partner,u=e.lastMessage,l=e.userId,d=e.author;return Object(a.jsx)(r.b,{to:"/dialog/".concat(c),children:Object(a.jsxs)("div",{className:X()("dialogs__item",{"dialogs__item--online":d._id===l?o.isOnline:d.isOnline,"dialogs__item--selected":i===c}),children:[Object(a.jsx)("div",{className:"dialogs__item-avatar",children:Object(a.jsx)(xe,{user:d._id===l?o:d})}),Object(a.jsxs)("div",{className:"dialogs__item-info",children:[Object(a.jsxs)("div",{className:"dialogs__item-info-top",children:[Object(a.jsx)("b",{children:d._id===l?o.fullname:d.fullname}),Object(a.jsx)("span",{children:(t=new Date(u.createdAt),Object(ue.a)(t)?Object(oe.a)(t,"HH:mm"):Object(oe.a)(t,"dd.MM.yyyy"))})]}),Object(a.jsxs)("div",{className:"dialogs__item-info-bottom",children:[Object(a.jsx)("p",{children:u.user._id===l?"\u0412\u044b: ".concat(le(u)):le(u)}),s&&Object(a.jsx)(ve,{isMe:s,isReaded:u.readed}),n>0&&Object(a.jsx)("div",{className:"dialogs__item-info-bottom-count",children:u.unreaded>9?"+9":u.unreaded})]})]})]})})},je=n(533),he=n(118),be=n(260),fe=n.n(be),me=(n(475),function(e){var t=e.items,n=e.userId,s=e.onSearch,c=e.currentDialogId,i=e.inputValue;return Object(a.jsxs)("div",{className:"dialogs",children:[Object(a.jsx)("div",{className:"dialogs__search",children:Object(a.jsx)(je.a.Search,{value:i,placeholder:"\u041f\u043e\u0438\u0441\u043a \u0441\u0440\u0435\u0434\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432",onChange:function(e){return s(e.target.value)}})}),t.length?fe()(t,["created_at"],["desc"]).map((function(e){return Object(a.jsx)(de,Object(Z.a)(Object(Z.a)({isMe:e.lastMessage.user._id===n,currentDialogId:c},e),{},{userId:n}),e._id)})):Object(a.jsx)(he.a,{image:he.a.PRESENTED_IMAGE_SIMPLE,description:"\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"})]})}),Oe=n(278),ge=n(279),pe=function(e){var t=e.date;return Object(a.jsx)(s.Fragment,{children:Object(Oe.a)(t,{addSuffix:!0,locale:ge.a})})},ve=function(e){var t=e.isMe,n=e.isReaded;return t&&(n?Object(a.jsx)(Y.a,{className:"message__icon-readed",icon:$.b,color:"#3674ff",alt:"Readed icon"}):Object(a.jsx)(Y.a,{className:"message__icon-readed",icon:$.a,color:"#3674ff",alt:"No readed icon"}))},xe=(n(487),function(e){var t=e.user;if(t.avatar)return Object(a.jsx)("img",{className:"avatar",src:t.avatar,alt:"Avatar ".concat(t.fullname)});var n=function(e){var t=e.substr(0,3).split("").map((function(e){return(t=e.charCodeAt(0))>255?255:t<0?0:t;var t})),n=Object(E.a)(t,3),a=n[0],s=n[1],c=n[2];return{color:y()({r:a,g:s,b:c}).lighten(20).saturate(20).toHexString(),colorLighten:y()({r:a,g:s,b:c}).lighten(40).saturate(30).toHexString()}}(t._id),s=n.color,c=n.colorLighten,i=t.fullname[0].toUpperCase();return Object(a.jsx)("div",{style:{background:"linear-gradient(135deg, ".concat(s," 0%, ").concat(c," 96.52%)")},className:"avatar avatar--symbol",children:i})}),_e=(n(488),function(e){var t=e.online,n=e.fullname;return Object(a.jsx)("div",{className:"chat__dialog-header",children:Object(a.jsxs)("div",{className:"chat__dialog-header-center",children:[Object(a.jsx)("b",{className:"chat__dialog-header-username",children:n}),Object(a.jsx)("div",{className:"chat__dialog-header-status",children:Object(a.jsx)("span",{className:X()("status",{"status--online":t}),children:t?"\u043e\u043d\u043b\u0430\u0439\u043d":"\u043e\u0444\u043b\u0430\u0439\u043d"})})]})})}),Se=n(537),Ee=n(538),we=n(539),ye=n(540),Ae=n(541),Ne=n(542),Ie=n(543),Me=n(262),Te=(n(493),je.a.TextArea),ke=function(e){var t=e.value,n=e.emojiPickerVisible,c=e.setValue,i=e.toggleEmojiPicker,r=e.addEmoji,o=e.handleSendMessage,u=e.sendMessage,l=e.attachments,d=e.onSelectFiles,j=e.onRecord,h=e.isRecording,b=e.onHideRecord,f=e.isLoading,m=e.removeAttachments;return Object(a.jsx)(s.Fragment,{children:Object(a.jsxs)("div",{className:"chat-input",children:[Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"chat-input__smile-btn",children:[Object(a.jsx)("div",{className:"chat-input__emoji-picker",children:n&&Object(a.jsx)(se.b,{onSelect:function(e){return r(e)},set:"apple"})}),Object(a.jsx)(J.a,{type:"link",shape:"circle",icon:Object(a.jsx)(Se.a,{}),onClick:i})]}),h?Object(a.jsxs)("div",{className:"chat-input__record-status",children:[Object(a.jsx)("i",{}),"Recording..."]}):Object(a.jsx)(Te,{onChange:function(e){return c(e.target.value)},onKeyUp:o,size:"large",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",value:t,autoSize:{minRows:1,maxRows:6}}),Object(a.jsxs)("div",{className:"chat-input__actions",children:[h?Object(a.jsx)(J.a,{type:"link",shape:"circle",icon:Object(a.jsx)(we.a,{className:"stop"}),onClick:b}):Object(a.jsx)(Me.UploadField,{onFiles:d,containerProps:{className:"chat-input__actions-upload"},uploadProps:{accept:".jpg,.jpeg,.png,.gif,.bmp",multiple:"multiple"},children:Object(a.jsx)(J.a,{type:"link",shape:"circle",icon:Object(a.jsx)(Ee.a,{})})}),f?Object(a.jsx)(J.a,{type:"link",shape:"circle",icon:Object(a.jsx)(ye.a,{})}):h||t||l.length?Object(a.jsx)(J.a,{onClick:u,type:"link",shape:"circle",icon:h?Object(a.jsx)(Ne.a,{className:"recording"}):Object(a.jsx)(Ae.a,{})}):Object(a.jsx)("div",{className:"chat-input__record-btn",children:Object(a.jsx)(J.a,{onClick:j,type:"link",shape:"circle",icon:Object(a.jsx)(Ie.a,{})})})]})]}),l.length>0&&Object(a.jsx)("div",{className:"chat-input__attachments",children:Object(a.jsx)(at,{attachments:l,removeAttachments:m})})]})})},Re=n(527),De=(n(494),function(e){var t=e.blockRef,n=e.isLoading,s=e.items,c=e.user,i=e.onRemoveMessage,r=e.blockHeight;return Object(a.jsx)("div",{className:"chat__dialog-messages",style:{height:"calc(100% - ".concat(r,"px)")},children:Object(a.jsx)("div",{className:X()("messages",{"messages--loading":n}),ref:t,children:n||!c?Object(a.jsx)(Re.a,{tip:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...",size:"large"}):s&&!n?s.length>0?s.map((function(e){return Object(a.jsx)(re,Object(Z.a)(Object(Z.a)({},e),{},{isMe:c._id===e.user._id,onRemoveMessage:i.bind(undefined,e._id)}),e._id)})):Object(a.jsx)(he.a,{description:"\u041d\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"}):Object(a.jsx)(he.a,{description:"\u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})})})}),Ce=function(e){var t=e.name,n=e.placeholder,s=e.prefix,c=e.type,i=e.touched,r=e.errors,o=e.handleBlur,u=e.handleChange,l=e.values;return Object(a.jsx)(B.a.Item,{validateStatus:_(t,i,r),help:i[t]?r[t]:" ",hasFeedback:!0,children:Object(a.jsx)(je.a,{value:l,id:t,prefix:s,placeholder:n,size:"large",type:c,onChange:u,onBlur:o})})},Le=n(531),Ue=n(532),Ge=n(544),Ve=n(545),Fe=Object(o.b)((function(e){return e.dialogs}),p)((function(e){var t=e.fetchDialogs,n=e.currentDialogId,c=e.items,i=e.userId,r=(e.dialogs,Object(s.useState)("")),o=Object(E.a)(r,2),u=o[0],l=o[1],d=Object(s.useState)(Array.from(c)),j=Object(E.a)(d,2),h=j[0],b=j[1];console.log(c);var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";b(c.filter((function(t){return t.author.fullname.toLowerCase().indexOf(e.toLowerCase())>=0||t.partner.fullname.toLowerCase().indexOf(e.toLowerCase())>=0}))),l(e)};return window.fetchDialogs=t,Object(s.useEffect)((function(){c.length&&f()}),[c]),Object(s.useEffect)((function(){return t(),O.on("SERVER:DIALOG_CREATED",t),O.on("SERVER:MESSAGE_CREATED",t),function(){O.removeListener("SERVER:DIALOG_CREATED",t),O.removeListener("SERVER:MESSAGE_CREATED",t)}}),[]),Object(a.jsx)(me,{userId:i,items:h,onSearch:f,inputValue:u,currentDialogId:n})})),Pe=Object(o.b)((function(e){var t=e.dialogs,n=e.messages,a=e.user,s=e.attachments;return{currentDialogId:t.currentDialogId,items:n.items,isLoading:n.isLoading,user:a.data,attachments:s.items}}),x)((function(e){var t=e.items,n=e.fetchMessages,c=e.currentDialogId,i=e.addMessage,r=e.isLoading,o=e.user,u=e.removeMessageById,l=e.attachments,d=Object(s.useState)(135),j=Object(E.a)(d,2),h=j[0],b=j[1],f=Object(s.useRef)(null),m=function(e){i(e)};return Object(s.useEffect)((function(){l.length?b(245):b(135)}),[l]),Object(s.useEffect)((function(){return c?(c&&n(c),O.on("SERVER:MESSAGE_CREATED",m),function(){O.removeListener("SERVER:MESSAGE_CREATED",m)}):null}),[c]),Object(s.useEffect)((function(){if(!c)return null;f.current.scrollTo(0,99999999)}),[t]),c?Object(a.jsx)(De,{user:o,blockRef:f,items:t,isLoading:r&&!o,onRemoveMessage:u,blockHeight:h}):null})),Be=n(95),He=n.n(Be),ze=n(166),Ze=n(159),Je=void 0,qe=Object(o.b)((function(e){return{dialogs:e.dialogs,attachments:e.attachments.items}}),Object(Z.a)(Object(Z.a)({},x),k))((function(e){var t=e.dialogs.currentDialogId,n=e.attachments,c=e.fetchSendMessage,i=e.setAttachments,r=e.removeAttachments;window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.mozGetUserMedia||window.navigator.webkitGetUserMedia||window.navigator.msGetUserMedia;var o=Object(s.useState)(""),u=Object(E.a)(o,2),l=u[0],d=u[1],j=Object(s.useState)(!1),h=Object(E.a)(j,2),b=h[0],m=h[1],O=Object(s.useState)(null),g=Object(E.a)(O,2),p=g[0],v=g[1],x=Object(s.useState)(!1),_=Object(E.a)(x,2),S=_[0],w=_[1],y=Object(s.useState)(!1),A=Object(E.a)(y,2),N=A[0],I=A[1],M=function(e){var t=new MediaRecorder(e);v(t),t.start(),t.onstart=function(){m(!0)},t.onstop=function(){m(!1)},t.ondataavailable=function(e){var t=new File([e.data],"audio.webm");I(!0),f.upload(t).then((function(e){var t=e.data;R(t.file._id).then((function(){I(!1)}))}))}},T=function(e){console.log(e)},k=function(e,t){e&&!e.contains(t.target)&&w(!1)},R=function(e){return c({text:null,dialogId:t,attachments:[e]})},D=function(){b?p.stop():(c({text:l,dialogId:t,attachments:n.map((function(e){return e.uid}))}),d(""),i([]))},C=function(){var e=Object(Ze.a)(He.a.mark((function e(t){var n,a,s;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=He.a.mark((function e(a){var s,c;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t[a],c=Math.round(1e3*Math.random()),n=[].concat(Object(ze.a)(n),[{uid:c,name:s.name,status:"uploading"}]),i(n),e.next=6,f.upload(s).then((function(e){var t=e.data;n=n.map((function(e){return e.uid===c?{uid:t.file._id,name:t.file.filename,status:"done",url:t.file.url}:e}))}));case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<t.length)){e.next=8;break}return e.delegateYield(a(s),"t0",5);case 5:s++,e.next=3;break;case 8:i(n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){var e=document.querySelector(".chat-input__smile-btn");return document.addEventListener("click",k.bind(Je,e)),function(){document.removeEventListener("click",k.bind(Je,e))}}),[]),t?Object(a.jsx)(ke,{value:l,setValue:d,emojiPickerVisible:S,toggleEmojiPicker:function(){w(!S)},addEmoji:function(e){var t=e.colons;d((l+" "+t).trim())},handleSendMessage:function(e){13===e.keyCode&&D()},sendMessage:D,attachments:n,onSelectFiles:C,isRecording:b,onRecord:function(){window.navigator.getUserMedia&&window.navigator.getUserMedia({audio:!0},M,T)},onHideRecord:function(){m(!1)},isLoading:N,removeAttachments:r}):Object(a.jsx)(he.a,{description:"\u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})})),Xe=Object(o.b)((function(e){var t=e.dialogs,n=e.user;return{dialogs:t.items,currentDialogId:t.currentDialogId,user:n.data}}))((function(e){var t=e.currentDialogId,n=e.user,s=e.dialogs;if(!s.length||!t)return null;var c=s.filter((function(e){return e._id===t}))[0],i={};return i=c.author._id===n._id?c.partner:c.author,Object(a.jsx)(_e,{online:i.isOnline,fullname:i.fullname})})),Ke=Object(o.b)((function(e){return{user:e.user.data}}))((function(e){var t=e.user,n=Object(s.useState)(!1),c=Object(E.a)(n,2),i=c[0],r=c[1],o=Object(s.useState)(""),u=Object(E.a)(o,2),l=u[0],d=u[1],h=Object(s.useState)(""),f=Object(E.a)(h,2),m=f[0],O=f[1],g=Object(s.useState)([]),p=Object(E.a)(g,2),v=p[0],x=p[1],_=Object(s.useState)(!1),S=Object(E.a)(_,2),w=S[0],y=S[1],A=Object(s.useState)(null),N=Object(E.a)(A,2),I=N[0],M=N[1],T=function(){r(!1)};return Object(a.jsx)(Qe,{user:t,visible:i,onClose:T,onShow:function(){r(!0)},inputValue:l,onSearch:function(e){y(!0),b.findUsers(e).then((function(e){var t=e.data;x(t),y(!1)})).catch((function(){y(!1)}))},onChangeInput:function(e){d(e)},onSelectUser:function(e){M(e)},users:v,onModalOk:function(){j.create({partner:I,text:m}).then((function(e){var t=e.data;console.log(t),T()})).catch((function(){y(!1)}))},onChangeTextArea:function(e){O(e.target.value)},messageText:m,isSearching:w,selectedUserId:I})})),We=Le.a.Option,Ye=je.a.TextArea,$e=function(e){var t=e.user,n=e.onShow,s=e.onClose,c=e.visible,i=e.users,r=e.onChangeInput,o=e.inputValue,u=e.onSearch,l=e.onSelectUser,d=e.onModalOk,j=e.isSearching,h=e.onChangeTextArea,b=e.messageText,f=e.selectedUserId,m=i.map((function(e){return Object(a.jsx)(We,{children:e.fullname},e._id)}));return Object(a.jsxs)("div",{className:"chat__sidebar",children:[Object(a.jsxs)("div",{className:"chat__sidebar-header",children:[Object(a.jsxs)("div",{className:"",children:[Object(a.jsx)(Ge.a,{}),Object(a.jsx)("span",{children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432"})]}),Object(a.jsx)(J.a,{onClick:n,type:"link",shape:"circle",icon:Object(a.jsx)(Ve.a,{})})]}),Object(a.jsx)("div",{className:"chat__sidebar-dialogs",children:Object(a.jsx)(Fe,{userId:t&&t._id})}),Object(a.jsx)(Ue.a,{title:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",visible:c,footer:[Object(a.jsx)(J.a,{onClick:s,children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"},"back"),Object(a.jsx)(J.a,{disabled:!b,type:"primary",loading:j,onClick:d,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"},"submit")],children:Object(a.jsxs)(B.a,{children:[Object(a.jsx)(B.a.Item,{label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u0438\u043b\u0438 \u043f\u043e\u0447\u0442\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",children:Object(a.jsx)(Le.a,{showSearch:!0,value:o,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u0438\u043b\u0438 \u043f\u043e\u0447\u0442\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",style:{width:"100%"},onSearch:u,onChange:r,notFoundContent:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSelect:l,children:m})}),f&&Object(a.jsx)(B.a.Item,{label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",children:Object(a.jsx)(Ye,{placeholder:"",autoSize:{mixRows:3,maxRows:10},onChange:h,value:b})})]})})]})};$e.defaultProps={users:[]};var Qe=$e,et=n(528);function tt(e){return new Promise((function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){return t(a.result)},a.onerror=function(e){return n(e)}}))}var nt=function(e){var t=e.attachments,n=e.removeAttachments,c=Object(s.useState)({previewVisible:!1,previewImage:"",fileList:t}),i=Object(E.a)(c,2),r=i[0],o=i[1],u=function(){var e=Object(Ze.a)(He.a.mark((function e(t){return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,tt(t.originFileObj);case 3:t.preview=e.sent;case 4:o(Object(Z.a)(Object(Z.a)({},r),{},{previewImage:t.url||t.preview,previewVisible:!0}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(s.useEffect)((function(){o(Object(Z.a)(Object(Z.a)({},r),{},{fileList:t}))}),[t]);return Object(a.jsxs)("div",{children:[Object(a.jsx)(et.a,{action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",listType:"picture-card",fileList:r.fileList,onPreview:u,onChange:function(e){var t=e.fileList;return o(Object(Z.a)(Object(Z.a)({},r),{},{fileList:t}))},onRemove:function(e){return n(e)}}),Object(a.jsx)(Ue.a,{visible:r.previewVisible,footer:null,onCancel:function(){return o(Object(Z.a)(Object(Z.a)({},r),{},{previewVisible:!1}))},children:Object(a.jsx)("img",{alt:"example",style:{width:"100%"},src:r.previewImage})})]})};nt.defaultProps={attachments:[]};var at=nt,st=function(e){var t=e.values,n=e.touched,s=e.errors,c=e.handleChange,i=e.handleBlur,o=e.handleSubmit,u=e.isSubmitting;return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"auth__top",children:[Object(a.jsx)("h2",{children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"}),Object(a.jsx)("p",{children:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})]}),Object(a.jsx)(W,{children:Object(a.jsxs)(B.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:o,children:[Object(a.jsx)(Ce,{value:t,placeholder:"E-mail",prefix:Object(a.jsx)(H.a,{className:"site-form-item-icon"}),name:"email",type:"email",touched:n,errors:s,handleChange:c,handleBlur:i}),Object(a.jsx)(Ce,{value:t,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",prefix:Object(a.jsx)(z.a,{className:"site-form-item-icon"}),name:"password",type:"password",touched:n,errors:s,handleChange:c,handleBlur:i}),Object(a.jsx)(B.a.Item,{children:Object(a.jsx)(K,{disabled:u,type:"primary",htmlType:"submit",className:"login-form-button button",size:"large",children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})}),Object(a.jsx)(r.b,{className:"auth__register-link",to:"/signup",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]})})]})},ct=Object(F.a)({enableReinitialize:!0,mapPropsToValues:function(){return{email:"",password:""}},validate:function(e){var t={};return P({isAuth:!0,values:e,errors:t}),t},handleSubmit:function(e,t){var n=t.setSubmitting,a=t.props;G.dispatch(T.fetchUserLogin(e)).then((function(e){"success"===e.status&&a.history.push("/"),n(!1)})).catch((function(){n(!0)}))},displayName:"LoginForm"})(st),it=n(548),rt=n(549),ot=function(e){var t=e.touched,n=e.errors,s=e.handleChange,c=e.handleBlur,i=e.handleSubmit,o=e.isValid,u=e.values;return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"auth__top",children:[Object(a.jsx)("h2",{children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(a.jsx)("p",{children:"\u0414\u043b\u044f \u0432\u0445\u043e\u0434\u0430 \u0432 \u0447\u0430\u0442, \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]}),Object(a.jsx)(W,{children:Object(a.jsxs)(B.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:i,children:[Object(a.jsx)(Ce,{value:u,placeholder:"E-mail",prefix:Object(a.jsx)(H.a,{className:"site-form-item-icon"}),name:"email",type:"email",touched:t,errors:n,handleChange:s,handleBlur:c}),Object(a.jsx)(Ce,{value:u,placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",prefix:Object(a.jsx)(it.a,{className:"site-form-item-icon"}),name:"fullname",type:"text",touched:t,errors:n,handleChange:s,handleBlur:c}),Object(a.jsx)(Ce,{value:u,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",prefix:Object(a.jsx)(z.a,{className:"site-form-item-icon"}),name:"password",type:"password",touched:t,errors:n,handleChange:s,handleBlur:c}),Object(a.jsx)(Ce,{value:u,placeholder:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",prefix:Object(a.jsx)(z.a,{className:"site-form-item-icon"}),name:"password_2",type:"password",touched:t,errors:n,handleChange:s,handleBlur:c}),Object(a.jsx)(B.a.Item,{children:Object(a.jsx)(K,{onClick:i,disabled:!o,type:"primary",htmlType:"submit",className:"login-form-button button",size:"large",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})}),Object(a.jsx)(r.b,{className:"auth__register-link",to:"/signin",children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})]})})]})},ut=Object(F.a)({enableReinitialize:!0,mapPropsToValues:function(){return{email:"",fullname:"",password:"",password_2:""}},validate:function(e){var t={};return P({isAuth:!1,values:e,errors:t}),t},handleSubmit:function(e,t){var n=t.setSubmitting,a=t.props;G.dispatch(T.fetchUserRegister(e)).then((function(e){"success"===e.status&&setTimeout((function(){a.history.push("/")}),100),n(!1)})).catch((function(){n(!0)}))},displayName:"RegisterForm"})(ot),lt=n(534),dt=function(e){var t=e.location,n=e.history,c=Object(s.useState)(!1),i=Object(E.a)(c,2),r=i[0],o=i[1],u=t.search.split("hash=")[1],l=function(e,t,n){return e?t?{status:"success",title:"\u0413\u043e\u0442\u043e\u0432\u043e!",message:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0451\u043d"}:{status:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430!",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430"}:{icon:Object(a.jsx)(rt.a,{style:{fontSize:"70px"}}),title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0430\u043a\u043a\u0430\u0443\u043d\u0442!",message:"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435\u043c \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u043f\u043e\u0447\u0442\u0443"}}(u,r);return Object(s.useEffect)((function(){u&&b.verifyHash(u).then((function(e){(e.data.status="success")&&o(!0)}))})),Object(a.jsx)(W,{children:Object(a.jsx)(lt.a,{status:l.status,icon:l.icon,title:l.title,subTitle:l.message,extra:"success"===l.status&&r&&Object(a.jsx)(J.a,{type:"primary",onClick:function(){return n.push("/signin")},children:"\u0412\u043e\u0439\u0442\u0438"})})})},jt=(n(521),function(){return Object(a.jsx)("section",{className:"auth",children:Object(a.jsxs)("div",{className:"auth__content",children:[Object(a.jsx)(V.b,{exact:!0,path:"/signin",component:ct}),Object(a.jsx)(V.b,{exact:!0,path:"/signup",component:ut}),Object(a.jsx)(V.b,{exact:!0,path:"/signup/verify",component:dt})]})})}),ht=(n(522),Object(V.g)(Object(o.b)((function(e){return{user:e.user.data}}),p)((function(e){var t=e.setCurrentDialogId,n=e.user;return Object(s.useEffect)((function(){var n=e.location.pathname.split("/").pop();t(n)}),[e.location.pathname]),Object(a.jsx)("section",{className:"home",children:Object(a.jsxs)("div",{className:"chat",children:[Object(a.jsx)(Ke,{}),n&&Object(a.jsxs)("div",{className:"chat__dialog",children:[Object(a.jsx)(Xe,{}),Object(a.jsx)(Pe,{}),Object(a.jsx)("div",{className:"chat__dialog-input",children:Object(a.jsx)(qe,{})})]})]})})})))),bt=Object(o.b)((function(e){return{isAuth:e.user.isAuth}}))((function(e){var t=e.isAuth;return Object(a.jsx)("div",{className:"wrapper",children:Object(a.jsxs)(V.d,{children:[Object(a.jsx)(V.b,{exact:!0,path:["/signin","/signup","/signup/verify"],component:jt}),Object(a.jsx)(V.b,{path:"/",render:function(){return t?Object(a.jsx)(ht,{}):Object(a.jsx)(V.a,{to:"/signin"})}})]})})}));n(523),n(524);G.dispatch(T.fetchUserData()),i.a.render(Object(a.jsx)(o.a,{store:G,children:Object(a.jsx)(r.a,{children:Object(a.jsx)(bt,{})})}),document.getElementById("root"))}},[[525,1,2]]]);
//# sourceMappingURL=main.25021146.chunk.js.map